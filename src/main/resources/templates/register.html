<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Register | My Store</title>
    <style>
        .pw-meter { height: 8px; background: #e9ecef; border-radius: 6px; overflow: hidden; }
        .pw-meter-bar { height: 100%; width: 0%; transition: width .25s ease; }
        .pw-weak   { background: #dc3545; }   /* red    */
        .pw-fair   { background: #fd7e14; }   /* orange */
        .pw-good   { background: #ffc107; }   /* yellow */
        .pw-strong { background: #28a745; }   /* green  */
    </style>
</head>
<body>
<section layout:fragment="content" class="container d-flex justify-content-center align-items-center" style="height: 100vh;">
    <div class="card shadow-lg p-4" style="width: 100%; max-width: 500px;">
        <h4 class="mb-4 text-center">Create an Account</h4>
        <div th:if="${error}" class="alert alert-danger" role="alert" th:text="${error}"></div>

        <form th:action="@{/register}" th:object="${customer}" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

            <div class="mb-3">
                <label for="username" class="form-label">Username</label>
                <input type="text" id="username" class="form-control" placeholder="Enter username" th:field="*{username}" required />
                <div class="text-danger" th:if="${#fields.hasErrors('username')}" th:errors="*{username}"></div>
            </div>

            <div class="mb-3">
                <label for="name" class="form-label">First Name</label>
                <input type="text" id="name" class="form-control" placeholder="Enter first name" th:field="*{name}" required />
                <div class="text-danger" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
            </div>

            <div class="mb-3">
                <label for="surname" class="form-label">Surname</label>
                <input type="text" id="surname" class="form-control" placeholder="Enter surname" th:field="*{surname}" required />
                <div class="text-danger" th:if="${#fields.hasErrors('surname')}" th:errors="*{surname}"></div>
            </div>

            <div class="mb-3">
                <label for="dateOfBirth" class="form-label">Date of Birth</label>
                <input type="date" id="dateOfBirth" class="form-control" th:field="*{dateOfBirth}" required />
                <div class="text-danger" th:if="${#fields.hasErrors('dateOfBirth')}" th:errors="*{dateOfBirth}"></div>
            </div>

            <div class="mb-3">
                <label for="address" class="form-label">Address</label>
                <input type="text" id="address" class="form-control" placeholder="Enter address" th:field="*{address}" required />
                <div class="text-danger" th:if="${#fields.hasErrors('address')}" th:errors="*{address}"></div>
            </div>

            <div class="mb-3">
                <label for="phoneNumber" class="form-label">Phone Number</label>
                <input type="text" th:field="*{phoneNumber}" class="form-control" id="phoneNumber">
                <div class="text-danger" th:if="${#fields.hasErrors('phoneNumber')}" th:errors="*{phoneNumber}"></div>
            </div>

            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" id="email" class="form-control" placeholder="Enter email" th:field="*{email}" required />
                <div class="text-danger" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></div>
            </div>

            <!-- Password -->
            <div class="mb-3">
                <label for="password" class="form-label">Password</label>
                <input type="password"
                       id="password"
                       class="form-control"
                       placeholder="Enter password"
                       th:field="*{password}"
                       required
                       minlength="3"
                       maxlength="12"
                       pattern="(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z0-9]).{3,12}"
                       title="Password must be 3–12 chars with upper, lower, digit and symbol." />
                <div class="text-danger" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></div>

                <div class="pw-meter mt-2">
                    <div id="pwBar" class="pw-meter-bar"></div>
                </div>
                <div class="d-flex justify-content-between mt-1 small">
                    <span id="pwLabel" class="text-muted">Strength: —</span>
                    <span class="text-muted">3–12 chars, upper/lower/digit/symbol</span>
                </div>
            </div>

            <!-- CAPTCHA -->
            <div class="mb-3">
                <label class="form-label">Enter the text from the image</label>
                <div class="d-flex align-items-center">
                    <img id="captchaImage" src="/captcha-image" alt="CAPTCHA" class="me-2" style="border: 1px solid #ccc; height: 50px;">
                    <button type="button" id="refreshCaptcha" class="btn btn-outline-secondary btn-sm">Refresh</button>
                </div>
                <label>
                    <input type="text" name="captcha" class="form-control mt-2" placeholder="Enter CAPTCHA" required>
                </label>
            </div>

            <div class="d-grid mb-3">
                <button type="submit" class="btn btn-success">Register</button>
            </div>
        </form>
        <div class="text-center">
            <a th:href="@{/login}">Already have an account? Login</a>
        </div>
    </div>
    <script th:src="@{/js/register.js}"></script>
    <script th:src="@{/js/captcha.js}"></script>
</body>
</html>